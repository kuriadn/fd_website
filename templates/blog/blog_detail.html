<!-- templates/blog/blog_detail.html -->
{% extends 'base.html' %}
{% load static %}
{% load blog_extras %}

{% block title %}{{ post.title }} | Fayvad Digital Blog{% endblock %}
{% block meta_description %}{{ post.excerpt|default:post.content|truncatewords:25|striptags }}{% endblock %}

{% block extra_head %}
<!-- Open Graph / Facebook -->
<meta property="og:type" content="article">
<meta property="og:title" content="{{ post.title }}">
<meta property="og:description" content="{{ post.excerpt|default:post.content|truncatewords:25|striptags }}">
{% if post.featured_image %}
<meta property="og:image" content="{{ request.scheme }}://{{ request.get_host }}{{ post.featured_image.url }}">
{% endif %}
<meta property="og:url" content="{{ request.scheme }}://{{ request.get_host }}{{ post.get_absolute_url }}">

<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:title" content="{{ post.title }}">
<meta property="twitter:description" content="{{ post.excerpt|default:post.content|truncatewords:25|striptags }}">
{% if absolute_image_url %}
<meta property="twitter:image" content="{{ absolute_image_url }}">
{% endif %}

<!-- Article specific meta -->
<meta property="article:published_time" content="{{ post.published_at|date:'c' }}">
<meta property="article:modified_time" content="{{ post.updated_at|date:'c' }}">
<meta property="article:author" content="{{ post.author.get_full_name|default:post.author.username }}">
<meta property="article:section" content="{{ post.category.name }}">
{% if post.tag_list %}
{% for tag in post.tag_list %}
<meta property="article:tag" content="{{ tag }}">
{% endfor %}
{% endif %}
{% endblock %}

{% block content %}
<article class="py-16">
    <div class="container mx-auto px-4">
        
        <!-- Breadcrumb -->
        <nav class="mb-8">
            <ol class="flex items-center space-x-2 text-sm text-gray-600">
                <li><a href="{% url 'pages:home' %}" class="hover:text-blue-600">Home</a></li>
                <li class="before:content-['/'] before:mx-2">
                    <a href="{% url 'blog:list' %}" class="hover:text-blue-600">Blog</a>
                </li>
                <li class="before:content-['/'] before:mx-2">
                    <a href="{% url 'blog:category' post.category.slug %}" class="hover:text-blue-600">
                        {{ post.category.name }}
                    </a>
                </li>
                <li class="before:content-['/'] before:mx-2 text-gray-400">{{ post.title|truncatechars:30 }}</li>
            </ol>
        </nav>

        <div class="max-w-4xl mx-auto">
            
            <!-- Article Header -->
            <header class="mb-8">
                <div class="flex items-center gap-2 mb-4">
                    <a href="{% url 'blog:category' post.category.slug %}" 
                       class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm hover:bg-blue-200">
                        {{ post.category.name }}
                    </a>
                    {% if post.is_featured %}
                    <span class="bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-sm">Featured</span>
                    {% endif %}
                </div>
                
                <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">{{ post.title }}</h1>
                
                {% if post.excerpt %}
                <p class="text-xl text-gray-600 mb-6">{{ post.excerpt }}</p>
                {% endif %}
                
                <!-- Author & Meta Info -->
                <div class="flex flex-wrap items-center justify-between border-b border-gray-200 pb-6">
                    <div class="flex items-center">
                        {% if post.author.profile_picture %}
                        <img src="{{ post.author.profile_picture.url }}" alt="{{ post.author.get_full_name }}" 
                             class="w-12 h-12 rounded-full mr-4">
                        {% else %}
                        <div class="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center mr-4">
                            <span class="text-white text-lg font-semibold">
                                {{ post.author.first_name|first|default:post.author.username|first }}
                            </span>
                        </div>
                        {% endif %}
                        <div>
                            <div class="text-gray-900 font-semibold">
                                {{ post.author.get_full_name|default:post.author.username }}
                            </div>
                            <div class="text-gray-500 text-sm">
                                Published {{ post.published_at|date:"F d, Y" }}
                                {% if post.reading_time %}
                                â€¢ {{ post.reading_time }} min read
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-4 mt-4 sm:mt-0">
                        <div class="flex items-center text-gray-500 text-sm">
                            <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                            </svg>
                            {{ post.view_count }} views
                        </div>
                        
                        <!-- Share Buttons -->
                        <div class="flex items-center space-x-2">
                            <span class="text-gray-500 text-sm">Share:</span>
                            <a href="https://twitter.com/intent/tweet?text={{ post.title|urlencode }}&url={{ request.scheme }}://{{ request.get_host }}{{ post.get_absolute_url|urlencode }}" 
                               target="_blank" class="text-blue-400 hover:text-blue-600">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
                                </svg>
                            </a>
                            <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.scheme }}://{{ request.get_host }}{{ post.get_absolute_url|urlencode }}" 
                               target="_blank" class="text-blue-600 hover:text-blue-800">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                                </svg>
                            </a>
                            <a href="https://www.linkedin.com/sharing/share-offsite/?url={{ request.scheme }}://{{ request.get_host }}{{ post.get_absolute_url|urlencode }}" 
                               target="_blank" class="text-blue-700 hover:text-blue-900">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-2.877-3.037-1.581 0-1.947 1.018-1.947 2.212v6.394H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                                </svg>
                            </a>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Featured Image -->
            {% if post.featured_image %}
            <div class="mb-8">
                <img src="{{ post.featured_image.url }}" alt="{{ post.title }}" 
                     class="w-full h-64 md:h-96 object-cover rounded-lg shadow-lg">
            </div>
            {% endif %}

            <!-- Article Content -->
            <div class="prose prose-lg prose-blue max-w-none mb-12 prose-headings:text-gray-900 prose-h2:text-2xl prose-h2:font-bold prose-h2:mt-8 prose-h2:mb-4">
                {{ post.content|markdown_to_html|safe }}
            </div>

            <!-- Tags -->
            {% if post.tag_list %}
            <div class="mb-8">
                <h3 class="text-lg font-semibold text-gray-900 mb-3">Tags:</h3>
                <div class="flex flex-wrap gap-2">
                    {% for tag in post.tag_list %}
                    <span class="bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-sm">
                        {{ tag }}
                    </span>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Navigation -->
            <nav class="flex flex-col sm:flex-row justify-between items-center border-t border-gray-200 pt-8 mb-12">
                {% if previous_post %}
                <a href="{% url 'blog:detail' previous_post.slug %}" 
                   class="flex items-center text-blue-600 hover:text-blue-800 mb-4 sm:mb-0">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                    </svg>
                    <div>
                        <div class="text-sm text-gray-500">Previous</div>
                        <div class="font-semibold">{{ previous_post.title|truncatechars:40 }}</div>
                    </div>
                </a>
                {% else %}
                <div></div>
                {% endif %}

                {% if next_post %}
                <a href="{% url 'blog:detail' next_post.slug %}" 
                   class="flex items-center text-blue-600 hover:text-blue-800 text-right">
                    <div>
                        <div class="text-sm text-gray-500">Next</div>
                        <div class="font-semibold">{{ next_post.title|truncatechars:40 }}</div>
                    </div>
                    <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                    </svg>
                </a>
                {% else %}
                <div></div>
                {% endif %}
            </nav>

            <!-- Related Posts -->
            {% if related_posts %}
            <section class="border-t border-gray-200 pt-12">
                <h2 class="text-2xl font-bold text-gray-900 mb-8">Related Articles</h2>
                <div class="grid md:grid-cols-3 gap-6">
                    {% for related in related_posts %}
                    <article class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow">
                        {% if related.featured_image %}
                        <img src="{{ related.featured_image.url }}" alt="{{ related.title }}" 
                             class="w-full h-32 object-cover">
                        {% else %}
                        <div class="w-full h-32 bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center">
                            <span class="text-white font-semibold">{{ related.category.name }}</span>
                        </div>
                        {% endif %}
                        <div class="p-4">
                            <h3 class="font-semibold text-gray-900 mb-2">
                                <a href="{% url 'blog:detail' related.slug %}" class="hover:text-blue-600">
                                    {{ related.title|truncatechars:50 }}
                                </a>
                            </h3>
                            <div class="text-sm text-gray-500">
                                {{ related.published_at|date:"M d, Y" }}
                            </div>
                        </div>
                    </article>
                    {% endfor %}
                </div>
            </section>
            {% endif %}

            <!-- Call to Action -->
            <div class="bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg p-8 text-white text-center mt-12">
                <h2 class="text-2xl font-bold mb-4">Ready to Transform Your Business?</h2>
                <p class="text-blue-100 mb-6">
                    Get expert guidance on digital solutions tailored for your SME or SACCO
                </p>
                <div class="flex flex-col sm:flex-row gap-4 justify-center">
                    <a href="{% url 'contact:form' %}" 
                       class="bg-white text-blue-600 px-6 py-3 rounded-lg font-semibold hover:bg-gray-100 transition-colors">
                        Get Free Consultation
                    </a>
                    <a href="{% url 'services:list' %}" 
                       class="border-2 border-white text-white px-6 py-3 rounded-lg font-semibold hover:bg-white hover:text-blue-600 transition-colors">
                        View Our Services
                    </a>
                </div>
            </div>

        </div>
    </div>
</article>

<!-- Schema.org structured data -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": "{{ post.title|escapejs }}",
  "description": "{{ post.excerpt|default:post.content|truncatewords:25|striptags|escapejs }}",
  {% if post.featured_image %}
  "image": "{{ request.scheme }}://{{ request.get_host }}{{ post.featured_image.url }}",
  {% endif %}
  "author": {
    "@type": "Person",
    "name": "{{ post.author.get_full_name|default:post.author.username|escapejs }}"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Fayvad Digital",
    "logo": {
      "@type": "ImageObject",
      "url": "{{ request.scheme }}://{{ request.get_host }}{% static 'images/logo.png' %}"
    }
  },
  "datePublished": "{{ post.published_at|date:'c' }}",
  "dateModified": "{{ post.updated_at|date:'c' }}",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "{{ request.scheme }}://{{ request.get_host }}{{ post.get_absolute_url }}"
  }
}
</script>
{% endblock %}